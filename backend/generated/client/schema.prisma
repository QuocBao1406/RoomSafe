generator client {
  provider = "prisma-client-js"
  output   = "../backend/generated/client"
}

datasource db {
  provider = "mysql"
  url      = env("DATABASE_URL")
}

model Users {
  user_id BigInt @id @default(autoincrement()) @db.UnsignedBigInt

  user_password   String  @db.VarChar(255)
  user_first_name String? @db.VarChar(255)
  user_last_name  String? @db.VarChar(255)

  user_gender   users_user_gender?
  user_birthday DateTime?          @db.Date
  user_phone    String?            @unique(map: "user_phone") @db.VarChar(20)
  user_email    String             @unique(map: "user_email") @db.VarChar(100)
  user_address  String?            @db.VarChar(255)
  user_avatar   String?            @db.VarChar(255)

  user_avg_rating   Decimal? @default(0.0) @db.Decimal(2, 1)
  user_review_count Int?     @default(0)
  user_bio          String?  @db.Text

  user_created_at   DateTime                @default(now()) @db.Timestamp(0)
  user_verification users_user_verification @default(UNVERIFIED)
  user_role         users_user_role
  posts             Posts[]

  // -- OTP
  otp             String?   @db.VarChar(255)
  otp_expiry_time DateTime? @db.Date

  // -- Reset Password
  password_reset_token   String?
  password_reset_expires DateTime?

  // -- Email Verification
  verified Boolean @default(false)
}

enum users_user_gender {
  MALE
  FEMALE
  OTHER
}

enum users_user_verification {
  UNVERIFIED
  PENDING
  VERIFIED
  REJECTED
}

enum users_user_role {
  LANDLORD
  TENANT
  ADMIN
}

model Posts {
  post_id           Int          @id @default(autoincrement())
  post_title        String       @db.VarChar(255)
  post_description  String       @db.Text
  post_price        Int
  post_area         Float
  price_electricity Int?
  price_water       Int?
  price_internet    Int?
  post_address      String       @db.VarChar(255)
  post_ward         String?      @db.VarChar(100)
  post_district     String       @db.VarChar(100)
  post_city         String       @db.VarChar(100)
  category          PostCategory @default(PHONG_TRO)
  status            PostStatus   @default(AVAILABLE)

  post_latitude  Float? // Vĩ độ
  post_longitude Float? // Kinh độ

  user_id BigInt @db.UnsignedBigInt
  user    Users  @relation(fields: [user_id], references: [user_id], onDelete: Cascade)

  // Quan hệ với Ảnh
  images PostImages[]

  created_at DateTime  @default(now())
  expired_at DateTime? // Ngày hết hạn tin đăng

  roommate_details RoommateDetails?

  @@map("posts") // Tên bảng trong DB
}

model RoommateDetails {
  id Int @id @default(autoincrement())

  // Quan hệ 1-1 với Posts
  post_id Int   @unique // Quan trọng: @unique đảm bảo 1 Post chỉ có 1 chi tiết
  post    Posts @relation(fields: [post_id], references: [post_id], onDelete: Cascade)

  // Các thông tin đặc thù tìm bạn
  gender_partner String? @default("ALL") // Mong muốn giới tính: NAM, NU, ALL
  age_range_min  Int? // Tuổi tối thiểu
  age_range_max  Int? // Tuổi tối đa
  career         String? // Nghề nghiệp: SINH_VIEN, DA_DI_LAM

  // Lưu trữ dạng text hoặc JSON String
  habits  String? @db.Text // Thói quen: "Ngủ sớm, Không hút thuốc, Sạch sẽ..."
  hobbies String? @db.Text // Sở thích: "Game, Đá bóng, Nấu ăn..."

  // Có thể thêm chi phí chia sẻ
  shared_cost String? // Ví dụ: "Chia đều", "Thỏa thuận"

  @@map("roommate_details")
}

model PostImages {
  image_id  Int    @id @default(autoincrement())
  image_url String @db.Text

  // Quan hệ N-1 với Posts
  post_id Int
  post    Posts @relation(fields: [post_id], references: [post_id], onDelete: Cascade)

  @@map("post_images")
}

enum PostStatus {
  AVAILABLE
  RENTED
  HIDDEN
}

enum PostCategory {
  PHONG_TRO
  CHUNG_CU
  NHA_NGUYEN_CAN
  O_GHEP
}

enum RoommateGender {
  MALE
  FEMALE
  ANY
}

enum RoommateStatus {
  ACTIVE
  FOUND
  CLOSED
}
