generator client {
  provider = "prisma-client-js"
  output   = "../backend/generated/client"
}

datasource db {
  provider = "mysql"
  url      = env("DATABASE_URL")
}

model Users {
  user_id           BigInt                  @id @default(autoincrement()) @db.UnsignedBigInt
  user_name         String                  @unique(map: "user_name") @db.VarChar(100)
  user_password     String                  @db.VarChar(255)
  user_full_name    String?                 @db.VarChar(255)
  user_gender       users_user_gender?
  user_birthday     DateTime?               @db.Date
  user_phone        String?                 @unique(map: "user_phone") @db.VarChar(20)
  user_email        String                  @unique(map: "user_email") @db.VarChar(100)
  user_address      String?                 @db.VarChar(255)
  user_avatar       String?                 @db.VarChar(255)
  user_avg_rating   Decimal?                @default(0.0) @db.Decimal(2, 1)
  user_review_count Int?                    @default(0)
  user_bio          String?                 @db.Text
  user_created_at   DateTime                @default(now()) @db.Timestamp(0)
  user_verification users_user_verification @default(UNVERIFIED)
  user_role         users_user_role
  posts             Posts[]
  roommate_posts RoommatePost[]
}

enum users_user_gender {
  MALE
  FEMALE
  OTHER
}

enum users_user_verification {
  UNVERIFIED
  PENDING
  VERIFIED
  REJECTED
}

enum users_user_role {
  LANDLORD
  TENANT
}

model Posts {
  post_id           Int          @id @default(autoincrement())
  post_title        String       @db.VarChar(255)
  post_description  String       @db.Text
  post_price        Int
  post_area         Float
  price_electricity Int?
  price_water       Int?
  price_internet    Int?
  post_address      String       @db.VarChar(255)
  post_ward         String?      @db.VarChar(100)
  post_district     String       @db.VarChar(100)
  post_city         String       @db.VarChar(100)
  category          PostCategory @default(PHONG_TRO)
  status            PostStatus   @default(AVAILABLE)

  user_id BigInt @db.UnsignedBigInt
  user    Users  @relation(fields: [user_id], references: [user_id], onDelete: Cascade)

  // Quan hệ với Ảnh
  images PostImages[]

  created_at DateTime  @default(now())
  expired_at DateTime? // Ngày hết hạn tin đăng

  @@map("posts") // Tên bảng trong DB
}

model PostImages {
  image_id  Int    @id @default(autoincrement())
  image_url String @db.Text

  // Quan hệ N-1 với Posts
  post_id Int
  post    Posts @relation(fields: [post_id], references: [post_id], onDelete: Cascade)

  @@map("post_images")
}

enum PostStatus {
  AVAILABLE
  RENTED
  HIDDEN
}

enum PostCategory {
  PHONG_TRO
  CHUNG_CU
  NHA_NGUYEN_CAN
}

enum RoommateGender {
  MALE
  FEMALE
  ANY
}

enum RoommateStatus {
  ACTIVE
  FOUND
  CLOSED
}

model RoommatePost {
  id                 Int             @id @default(autoincrement())
  title              String          @db.VarChar(255)
  description        String          @db.Text
  budget             Int
  preferred_area     String          @db.VarChar(255)
  gender_preference  RoommateGender  @default(ANY)
  age_min            Int?
  age_max            Int?
  habits             String?         @db.Text
  contact_zalo       String?         @db.VarChar(255)
  contact_messenger  String?         @db.VarChar(255)
  contact_phone      String?         @db.VarChar(50)
  photos             Json?
  status             RoommateStatus  @default(ACTIVE)

  user_id BigInt @db.UnsignedBigInt
  user    Users  @relation(fields: [user_id], references: [user_id], onDelete: Cascade)

  created_at DateTime @default(now())
  updated_at DateTime @updatedAt

  @@map("roommate_posts")
}